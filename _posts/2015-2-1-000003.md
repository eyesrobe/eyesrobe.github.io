---
layout: post
title: 【編集中】WiringPi2 for Python でLチカ (without sudo)
---

------------------------------------
注意：電子工作素人の記事です

Raspberry Pi Model B+のGPIOをブラウザから操作できるようにするという目的のための関連記事一覧

1. [Raspberry PiにWiringPiをインストール](../000000/)
2. [Raspberry PiにWiringPi2 for Pythonをインストール](../000001/)
3. [WiringPi2 for Python でLチカ (with sudo)](../000002/)
4. 今回 ＞ __WiringPi2 for Python でLチカ (without sudo)__
5. ブラウザから操作

------------------------------------

## Wiringpi2 for Pythonをsudoなしで動作させる


制限

sudoなしの場合、wiringPiSetupSys()でセットアップする。
かつ、pinMode（入力か出力）の設定はpythonスクリプト内では指定できないので、使用するPINはシェルであらかじめ使用できる状態にしておく必要がある。
python3では動かない

| ng | WiringPi番号 | wiringPiSetup()     |
| ng | GPIO番号     | wiringPiSetupGpio() |
| ng | Pin番号      | wiringPiSetupPhys() |
| OK | GPIO番号     | wiringPiSetupSys()  |



sudoしない場合に動かないときの参考
http://stackoverflow.com/questions/20828758/using-wiringpi2-python-non-root-segmentation-fault-catching-for-gpio

準備

・シェルスクリプト(set_gpio_pins.sh)を作成
・set_gpio_pins.shのパーミッションを変更
・シェルスクリプト実行

```
$
$ nano set_gpio_pins.sh

$
$ chmod 744 set_gpio_pins.sh

$
$ sudo ./set_gpio_pins.sh


```

使用するPINのGPIO番号をpinsに指定

```
set_gpio_pins.sh

#!/bin/bash

# set GPIO pin numbers
# e.g. pins=( 18 22 24 ) # use GPIO18,GPIO22,GPIO24
pins=( 18 22 24 )

for pin in ${pins[@]}; do
   /usr/local/bin/gpio export $pin out
   chown -R www-data:pi /sys/devices/virtual/gpio/gpio$pin
   chmod -R g+w /sys/devices/virtual/gpio/gpio$pin
done

```





動くコード

```
$
$ python wiringpi2test_without_sudo.py
$

```


```
wiringPi2test_without_sudo.py

import time
import wiringpi2 as pi
from multiprocessing import Process

def f(i):
        status = 1
        if 1 == pi.digitalRead(18) :
                status = 0

        print status
        pi.digitalWrite(18,status)

if __name__ == '__main__':
        pi.wiringPiSetupSys()

        for num in range(10):
                Process(target=f, args=(num,)).start()
                time.sleep(0.5)
```

動かないコード

GPIOがオンになるけどオフにならない。

```
$
$ python wiringPi2test_without_sudo_err.py
Segmentation fault
$

```

```
wiringPi2test_without_sudo_err.py


#
# 動かないコード
#
import wiringpi2 as pi
pi.wiringPiSetupSys()
pi.digitalWrite(18,1) # 処理される（この処理が終わると Segmentation faultで止まる）
print 9999            # 処理されない
pi.digitalWrite(18,0) # 処理されない

```
